<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nellai  Karupatti Coffee - Sharjah- Menu</title>
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom styles for a rich, wooden texture feel */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7f3ed; /* Light cream/parchment background */
        }
        .wood-dark {
            background-color: #5d4037; /* Rich, dark brown (Walnut) */
            color: #f5e4c3; /* Light tan/cream text */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2), 0 4px 6px -2px rgba(0, 0, 0, 0.15);
        }
        .wood-light {
            background-color: #e9d5a1; /* Pale oak/tan for menu cards */
            color: #3e2723; /* Dark espresso text */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .wood-light:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.1);
        }
        .price {
            font-weight: 700;
            color: #8d6e63; /* Medium brown accent */
        }
        /* Style for the filter dropdown */
        #category-filter {
            padding: 8px 16px;
            border-radius: 6px;
            border: 2px solid #5d4037;
            background-color: #fff;
            color: #3e2723;
            font-weight: 600;
            cursor: pointer;
            appearance: none; /* Remove default styling */
            background-image: url('data:image/svg+xml;charset=US-ASCII,%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%22292.4%22%20height%3D%22292.4%22%3E%3Cpath%20fill%3D%22%235d4037%22%20d%3D%22M287%20197.35l-131.3%20131.3c-4.1%204.1-9.5%206.2-14.9%206.2s-10.8-2-14.9-6.2L5.4%20197.35c-8.2-8.2-8.2-21.5%200-29.7%208.2-8.2%2021.5-8.2%2029.7%200l110.4%20110.4L257.35%20167.65c8.2-8.2%2021.5-8.2%2029.7%200%208.2%208.2%208.2%2021.5%200%2029.7z%22%2F%3E%3C%2Fsvg%3E');
            background-repeat: no-repeat;
            background-position: right 10px top 50%;
            background-size: 12px;
            max-width: 100%;
        }
	/* Style for the search input */
        #search-input {
            padding: 8px 12px;
            border-radius: 6px;
            border: 2px solid #5d4037;
            background-color: #fff;
            color: #3e2723;
            font-weight: 500;
            /* Tailwind classes for focus */
            outline: none;
            box-shadow: 0 0 0 1px #8d6e63;
        }	
    </style>
</head>
<body class="antialiased">

    <!-- Main Container -->
    <div class="max-w-4xl mx-auto p-4 sm:p-6 lg:p-8">

        <!-- Restaurant Name (Header) -->
        <header class="text-center py-8 rounded-xl wood-dark mb-8">
            <h1 class="text-4xl font-extrabold tracking-tight sm:text-5xl">
                Nellai  Karupatti Coffee - Sharjah
            </h1>
            <p class="mt-1 text-base font-light opacity-80">Pure Veg Restaurant</p>
        </header>

        <!-- Today's Special Block -->
        <section id="specials-container" class="wood-dark p-5 rounded-xl mb-8">
            <h2 class="text-2xl font-bold border-b-2 border-amber-500/50 pb-2 mb-3">
                Today's Specials
            </h2>
            <!-- Specials items will be injected here by JavaScript -->
        </section>

        <!-- Category Filter Control - NEW -->
        <div id="filter-controls" class="mb-6 flex flex-col sm:flex-row gap-3 justify-center items-center">
            <!-- Dropdown will be injected here by JavaScript -->
        </div>

        <!-- Main Menu Section -->
        <section id="menu-container" class="mt-8">
            <h2 class="text-3xl font-extrabold text-amber-900 mb-6 text-center">
                Our Full Menu
            </h2>
            <!-- Category sections and menu items will be injected here by JavaScript -->
        </section>

        <!-- Contact Details -->
        <footer class="mt-16 pt-8 border-t-2 border-amber-900/20 text-center text-stone-700">
            <h3 class="text-xl font-semibold mb-2">Connect With Us</h3>
            <p>Shop No 11, 4th Street, Al Soor, Opposite Saudi Mostque, Sharjah</p>
            <p>Reservations: 06 715 5049 | <a href="wcrllc2024@gmail.com" class="hover:underline text-amber-800">wcrllc2024@gmail.com</a></p>
            <p class="mt-4 text-sm">&copy; 2025 Wooden Cup Restaurant LLC. All Rights Reserved.</p>
        </footer>

    </div>

    <!-- JavaScript for Menu Logic -->
    <script>
        // --- LIVE MENU DATA LOADER ---
        
        // !!! PASTE YOUR DEPLOYED GOOGLE APPS SCRIPT WEB APP URL HERE !!!
        const SHEET_JSON_URL = "https://script.google.com/macros/s/AKfycbyESBay7qaCKwbBLljddJ3Vu9WQryNg9aXuJz96vZRNrN1GNSVhuciea9xNqCyUWIm5/exec"; 
        
        // Set update interval to 60 seconds (60,000 milliseconds) for live updates
        const UPDATE_INTERVAL_MS = 60000; 
        
        // Fallback data structure for development/testing if the API fails
        const FALLBACK_MENU_DATA = [
            // BREAKFAST (3 items for demo)
            { "Food Item": "Idly (2pcs)", "Category": "Breakfast", "Price": 4.00, "Todays Special": "No" },
            { "Food Item": "Dosa", "Category": "Breakfast", "Price": 4.50, "Todays Special": "No" },
            { "Food Item": "Poori", "Category": "Breakfast", "Price": 7.00, "Todays Special": "Yes" },
            // LUNCH (3 items for demo)
            { "Food Item": "Meals", "Category": "Lunch", "Price": 10.00, "Todays Special": "Yes" },
            { "Food Item": "Tomato Rice", "Category": "Lunch", "Price": 6.00, "Todays Special": "No" },
            { "Food Item": "Mint Rice", "Category": "Lunch", "Price": 6.00, "Todays Special": "No" },
            // CHAAT/SNACKS (3 items for demo)
            { "Food Item": "Pani Puri", "Category": "Chaat", "Price": 5.00, "Todays Special": "No" },
            { "Food Item": "Vada Pav", "Category": "Chaat", "Price": 3.00, "Todays Special": "Yes" },
            { "Food Item": "Kachori", "Category": "Chaat", "Price": 2.00, "Todays Special": "No" },
            // DINNER (3 items for demo)
            { "Food Item": "Chapatti", "Category": "Dinner", "Price": 6.00, "Todays Special": "No" },
            { "Food Item": "Family Dosa", "Category": "Dinner", "Price": 20.00, "Todays Special": "Yes" },
            { "Food Item": "Rava Dosa", "Category": "Dinner", "Price": 8.00, "Todays Special": "No" },
            // SWEETS (2 items for demo)
            { "Food Item": "Gulab Jamun", "Category": "Sweets", "Price": 5.50, "Todays Special": "No" },
            { "Food Item": "Rasgulla", "Category": "Sweets", "Price": 6.00, "Todays Special": "No" },
            // DRINKS (2 items for demo)
            { "Food Item": "Fresh Milk Tea", "Category": "Drinks", "Price": 2.00, "Todays Special": "No" },
            { "Food Item": "Fresh Milk Coffee", "Category": "Drinks", "Price": 3.00, "Todays Special": "No" },
        ];
        // ------------------------------------
        
        // Global variables to store the latest fetched menu data and current filters
        let currentMenuData = FALLBACK_MENU_DATA;
        let currentSearchQuery = '';
        let currentFilterCategory = 'All Categories';

        function formatPrice(price) {
            const numericPrice = parseFloat(price);
            if (isNaN(numericPrice)) {
                return 'N/A';
            }
            return `AED ${numericPrice.toFixed(2)}`; 
        }

        // NEW FUNCTION: Sets up the search input and event listener
        function setupSearchInput() {
            const filterControls = document.getElementById('filter-controls');
            
            // Create Search Input
            const searchInputHtml = document.createElement('input');
            searchInputHtml.id = 'search-input';
            searchInputHtml.type = 'text';
            searchInputHtml.placeholder = 'Search by item name...';
            searchInputHtml.className = 'w-full sm:w-64 block'; 
            
            filterControls.appendChild(searchInputHtml);
            
            // Add Event Listener for real-time filtering
            searchInputHtml.addEventListener('input', (event) => {
                currentSearchQuery = event.target.value.toLowerCase().trim();
                // Re-render the menu using all current filters (category + search)
                applyFiltersAndRenderMenu();
            });
        }
        
        // UPDATED FUNCTION: Sets up the filter dropdown and event listener
        function setupCategoryFilter(menuData) {
            const filterControls = document.getElementById('filter-controls');
            // Remove previous dropdown if exists to ensure only one is present
            const existingSelect = document.getElementById('category-filter');
            if (existingSelect) existingSelect.remove();

            // 1. Extract all unique categories
            const allCategories = new Set(
                menuData
                    .map(item => item.Category)
                    .filter(cat => cat && cat.trim() !== '')
            );
            const sortedCategories = ['All Categories', ...Array.from(allCategories).sort()];

            // 2. Build the Select element
            const selectHtml = document.createElement('select');
            selectHtml.id = 'category-filter';
            // Added sm:w-48 to constrain width on larger screens for better spacing
            selectHtml.className = 'w-full sm:w-48 block text-base sm:text-lg'; 

            sortedCategories.forEach(category => {
                const option = document.createElement('option');
                option.value = category;
                option.textContent = category;
                selectHtml.appendChild(option);
            });
            
            // Insert the search input first, then the filter dropdown
            const searchInput = document.getElementById('search-input');
            if (searchInput) {
                 filterControls.insertBefore(selectHtml, searchInput);
            } else {
                 filterControls.appendChild(selectHtml);
            }

            // 3. Add Event Listener to re-render the menu on change
            selectHtml.addEventListener('change', (event) => {
                currentFilterCategory = event.target.value;
                // Re-render the main menu using all current filters (category + search)
                applyFiltersAndRenderMenu();
            });
        }
        
        // NEW FUNCTION: Combines category and search filters before rendering
        function applyFiltersAndRenderMenu() {
            let filteredData = currentMenuData;
            
            // 1. Apply Category Filter
            if (currentFilterCategory !== 'All Categories') {
                filteredData = filteredData.filter(item => item.Category === currentFilterCategory);
            }
            
            // 2. Apply Search Filter
            if (currentSearchQuery) {
                filteredData = filteredData.filter(item =>
                    (item["Food Item"] && item["Food Item"].toLowerCase().includes(currentSearchQuery)) ||
                    (item.Category && item.Category.toLowerCase().includes(currentSearchQuery))
                );
            }
            
            // 3. Render the result
            renderMenuContent(filteredData, currentFilterCategory);
        }

        // RENAMED FUNCTION: Now specifically renders the content based on filtered data
        function renderMenuContent(menuDataToRender, filterCategory = 'All Categories') {
            const specialsContainer = document.getElementById('specials-container');
            const menuContainer = document.getElementById('menu-container');

            // --- 1. Filter and Render Today's Specials (always displayed) ---
            const specials = menuDataToRender.filter(item => item["Todays Special"] && String(item["Todays Special"]).trim().toLowerCase() === 'yes');

            let specialsHtml = '';
            if (specials.length > 0) {
                // Using sm:grid-cols-2 for better mobile/desktop spread
                specialsHtml += '<div class="grid grid-cols-2 sm:grid-cols-3 lg:grid-cols-4 gap-3">';
                specials.forEach(item => {
                    // Note: Specials are only filtered by search, not category, to keep them visible when possible
                    specialsHtml += `
                        <div class="p-3 rounded-lg bg-amber-700/50 text-amber-50 shadow-md">
                            <p class="text-sm font-bold">${item["Food Item"]}</p>
                            <p class="text-xs opacity-90">${item["Category"]}</p>
                            <p class="text-base font-extrabold mt-1 text-white">${formatPrice(item.Price)}</p>
                        </div>
                    `;
                });
                specialsHtml += '</div>';
            } else {
                specialsHtml = '<p class="text-center py-3 opacity-70 text-base">No specials selected today. Check back soon!</p>';
            }
            // Preserve the main H2 title and inject the list of specials
            specialsContainer.innerHTML = specialsContainer.innerHTML.split('</h2>')[0] + '</h2>' + specialsHtml;

            
            // --- 2. Group Remaining Items by Category and Render Main Menu ---

            // Filter out specials for the main menu list
            const mainMenuItems = menuDataToRender.filter(item => !item["Todays Special"] || String(item["Todays Special"]).trim().toLowerCase() !== 'yes');

            // Group the remaining items by Category
            const menuByCategory = mainMenuItems.reduce((acc, item) => {
                const category = item.Category;
                if (!acc[category]) {
                    acc[category] = [];
                }
                acc[category].push(item);
                return acc;
            }, {});

            // Determine which categories to render based on the filter (only impacts the main menu structure)
            const allCategories = Object.keys(menuByCategory).sort();
            const categoriesToRender = filterCategory === 'All Categories' 
                ? allCategories 
                : allCategories.filter(c => c === filterCategory);

            let menuHtml = `
                <h2 class="text-3xl font-extrabold text-amber-900 mb-6 text-center">
                    ${filterCategory === 'All Categories' ? 'Our Full Menu' : filterCategory + ' Items'}
                </h2>
            `;
            
            if (categoriesToRender.length === 0 && currentSearchQuery) {
                 menuHtml += '<p class="text-center text-stone-600 py-6">No items matching your search were found.</p>';
            } else if (categoriesToRender.length === 0) {
                 menuHtml += '<p class="text-center text-stone-600 py-6">No items found in this category selection.</p>';
            }


            categoriesToRender.forEach(category => {
                const items = menuByCategory[category];

                if (items && items.length > 0) {
                    menuHtml += `
                        <!-- Category Header (Smaller/Compacted) -->
                        <div class="mb-6 mt-6">
                            <h3 class="text-xl font-extrabold text-amber-900 border-b-2 border-amber-900/30 pb-1 mb-4 uppercase tracking-wider">${category}</h3>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-x-4 gap-y-3">
                    `;
                    items.forEach(item => {
                        menuHtml += `
                            <!-- Menu Item Card (Compacted) -->
                            <div class="wood-light p-3 rounded-md flex justify-between items-center shadow-md">
                                <div>
                                    <p class="text-base font-semibold">${item["Food Item"]}</p>
                                </div>
                                <span class="price text-lg ml-4 whitespace-nowrap">${formatPrice(item.Price)}</span>
                            </div>
                        `;
                    });
                    menuHtml += `
                            </div>
                        </div>
                    `;
                }
            });

            // Inject the main menu HTML
            menuContainer.innerHTML = menuHtml;
        }

        async function fetchAndRenderMenu() {
            let menuDataToUse = FALLBACK_MENU_DATA;
            
            // Exponential backoff parameters
            const MAX_RETRIES = 3;
            const INITIAL_DELAY_MS = 1000;

            // Check if the URL has been updated from the placeholder
            const usingPlaceholder = SHEET_JSON_URL.includes("YOUR_PUBLIC_GOOGLE_SHEET_JSON_API_LINK_GOES_HERE");
            
            if (usingPlaceholder) {
                 console.warn("Using fallback data. Please replace SHEET_JSON_URL with your actual public JSON endpoint for live updates.");
            } else {
                for (let i = 0; i < MAX_RETRIES; i++) {
                    try {
                        const response = await fetch(SHEET_JSON_URL);
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        
                        const fetchedData = await response.json();

                        if (Array.isArray(fetchedData) && fetchedData.length > 0) {
                            menuDataToUse = fetchedData.map(item => ({
                                "Food Item": item["Food Item"] || "N/A",
                                "Category": item["Category"] || "Other",
                                "Price": parseFloat(item["Price"]) || 0,
                                "Todays Special": item["Todays Special"] || "",
                            }));
                            console.log("Successfully fetched live menu data.");
                            break; 
                        } else {
                            throw new Error("Fetched data is empty or incorrectly structured.");
                        }
                        
                    } catch (error) {
                        console.error(`Attempt ${i + 1} failed to fetch menu data from API.`, error.message);
                        
                        if (i < MAX_RETRIES - 1) {
                            const delay = INITIAL_DELAY_MS * Math.pow(2, i);
                            await new Promise(resolve => setTimeout(resolve, delay));
                        } else {
                            console.warn("All attempts failed. Using fallback data.");
                        }
                    }
                }
            }
            
            // Store the fetched data globally
            currentMenuData = menuDataToUse;
            
            // Setup the filters and search based on the fetched data
            setupSearchInput(); // Setup the search bar first
            setupCategoryFilter(currentMenuData); // Setup the filter dropdown
            
            // Initial render
            applyFiltersAndRenderMenu();
        }


        // Run the data fetching and rendering function when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            // Initial fetch on page load
            fetchAndRenderMenu();

            // Set up interval to fetch data and update the menu every minute
            setInterval(fetchAndRenderMenu, UPDATE_INTERVAL_MS);
            console.log(`Live menu updates enabled, fetching data every ${UPDATE_INTERVAL_MS / 1000} seconds.`);
        });
    </script>

</body>
</html>
